{% extends 'jobs/base.html' %}

{% block title %}Parse CV{% endblock %}

{% block content %}
<section class="container mt-5">
    <div class="dashboard-container">
        <div class="circle circle-one"></div>
        <div class="form-container">
            <h1 class="opacity">Parse Your CV</h1>
            <form id="job-search-form" class="mb-4">
                {% csrf_token %}
                {{ job_search_form.query.label_tag }}
                {{ job_search_form.query }}
                <button type="button" id="search-jobs-btn" class="btn btn-primary">Search Jobs</button>
            </form>
            <form id="resume-upload-form" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="job_id" id="job-id-input">
                {{ resume_upload_form.resume.label_tag }}
                {{ resume_upload_form.resume }}
                <button type="submit" class="btn btn-primary">Upload and Parse CV</button>
            </form>
            <div id="job-results" class="mt-4"></div>
        </div>
        <div class="circle circle-two"></div>
    </div>
    <div class="theme-btn-container"></div>
</section>

<script>
document.getElementById('search-jobs-btn').addEventListener('click', function() {
    var query = document.getElementById('id_query').value;
    fetch(`/jobs/search-jobs-for-cv/?query=${query}`)
        .then(response => response.json())
        .then(data => {
            var jobResults = document.getElementById('job-results');
            jobResults.innerHTML = '';
            data.forEach(job => {
                var jobElement = document.createElement('div');
                jobElement.classList.add('job-item');
                jobElement.innerHTML = `<input type="radio" name="job_id" value="${job.id}"> ${job.title} at ${job.company}`;
                jobResults.appendChild(jobElement);
            });
        });
});

document.getElementById('resume-upload-form').addEventListener('submit', function(e) {
    var selectedJob = document.querySelector('input[name="job_id"]:checked');
    if (selectedJob) {
        document.getElementById('job-id-input').value = selectedJob.value;
    } else {
        alert('Please select a job before submitting.');
        e.preventDefault();
    }
});
</script>
{% endblock %}
